function e(e,t){let{rows:n,children:l}=e;const s="table"===t?n:l,i=[].slice.call(s).filter(e=>"hidden"===e.className).length;return 0!==i?" "+i:""}function t(e,t){void 0===t&&(t=!1),e.classList[t?"add":"remove"]("hidden")}const n={newLine:{match:/(\r\n|\n|\r)/gm,replace:""},space:{match:/\s\s+/gm,replace:" "},br:{match:/<br\s*\/?>/gim,replace:""},html:{match:/(<((?!b|\/b|!strong|\/strong)[^>]+)>)/gi,replace:""}};class l{constructor(e,t){let{onMoreLess:l=(()=>{}),regex:s={},config:i}=void 0===t?{}:t;const a=document.querySelectorAll(e);this.onMoreLess=l,this.regex=Object.assign(n,s);for(let e=0;e<a.length;e++){const{type:t,limit:n,element:l,after:s,more:r,less:c,number:o,ellipsis:d,btnClass:h,btnClassAppend:p}=JSON.parse(a[e].getAttribute("data-config"))||i;this.object={index:e,element:a[e],type:t,limit:n,classArray:a[e].classList,ellipsis:d,typeElement:l||"span",more:r||!1,less:c||!1,number:o||!1,after:s||0,btnClass:h||"show-more-btn",btnClassAppend:p||null},this.initial(this.object)}}initial(e){let{element:n,after:l,ellipsis:s,limit:i,type:a}=e;n.ariaExpanded=!1;const r=i+l,c=!1===s?"":"...";if("text"===a){let e="";const t=n.innerHTML.trim();let l=n.textContent.trim(),s=t;for(let e in this.regex){const{match:t,replace:n}=this.regex[e];e&&t&&(s=s.replace(t,n))}l.length>r&&(e=function(e,t){let n=document.createElement("div");return n.innerHTML=e,function e(t,n){let l=t.firstChild;do{3===l.nodeType?n(l):1===l.nodeType&&l.childNodes&&l.childNodes[0]&&e(l,n)}while(l=l.nextSibling)}(n,(function(e){if(t>0){let n=e.data.length;(t-=n)<=0&&(e.data=e.substringData(0,e.data.length+t))}else e.data=""})),n.innerHTML}(s,i).concat(c),n.innerHTML=e,this.addBtn(this.object),this.clickEvent(n,{...this.object,originalText:t,truncatedText:e}))}if("list"===a||"table"===a){const e="list"===a?[].slice.call(n.children):n.rows;if(e.length>r){for(let n=i;n<e.length;n++)t(e[n],!0);this.addBtn(this.object),this.clickEvent("list"===a?n:n.nextElementSibling,this.object)}}}clickEvent(e,t){e.addEventListener("click",this.handleEvent.bind(this,t))}createBtn(t){let{element:n,number:l,less:s,more:i,type:a,btnClass:r,btnClassAppend:c}=t;const o=this.checkExp?s||"":i||"",d=this.checkExp?"collapse":"expand",h=!!this.checkExp,p=document.createElement("button");return p.className=null==c?r:r+" "+c,p.ariaExpanded=h,p.ariaLabel=d,p.tabindex=0,p.innerHTML=l?o+e(n,a):o,p}handleEvent(e,n){let{currentTarget:l,target:s}=n;const{element:i,type:a,limit:r,less:c,typeElement:o,originalText:d,truncatedText:h,btnClass:p}=e,m=s.classList.contains(p);if(!m)return;const b=i.getAttribute("aria-expanded");if(this.checkExp="false"===b,"text"===a&&m&&(i.innerHTML="",i.innerHTML=this.checkExp?d:h,c)){const t=document.createElement(o);t.insertAdjacentElement("beforeend",this.createBtn(e)),i.appendChild(t)}if("list"===a||"table"===a){const e="list"===a?[].slice.call(l.children):i.rows;for(let n=0;n<e.length;n++){const l="list"===a?n>=r&&n<e.length-1:n>=r;"false"===b?t(e[n]):l&&t(e[n],!0)}}"table"!==a&&"list"!==a&&"text"!==a||this.setExpand({...e,target:s})}addBtn(e){const{type:t,element:n,more:l,typeElement:s}=e;if(l)if("table"===t)n.insertAdjacentElement("afterend",this.createBtn(e));else{const t=document.createElement(s);t.appendChild(this.createBtn(e)),n.appendChild(t)}}setExpand(t){const{element:n,type:l,less:s,more:i,number:a,target:r}=t,c=this.checkExp,o=c?s:i,d=c?"expand":"collapse",h="table"===l?l:"the "+l,p=n.lastElementChild;n.ariaExpanded=c,r.ariaExpanded=c,r.ariaLabel=d+" "+h,this.onMoreLess(d,t),o?r.innerHTML=a?o+e(n,l):o:"table"===l?r.parentNode.removeChild(r):"list"===l&&p.parentNode.removeChild(p)}}export{l as default};
