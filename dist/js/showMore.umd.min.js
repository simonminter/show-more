!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ShowMore=t()}(this,(function(){"use strict";function e(e,t){let{rows:n,children:i}=e;const l="table"===t?n:i,s=[].slice.call(l).filter(e=>"hidden"===e.className).length;return 0!==s?" "+s:""}function t(e,t){void 0===t&&(t=!1),e.classList[t?"add":"remove"]("hidden")}const n={newLine:{match:/(\r\n|\n|\r)/gm,replace:""},space:{match:/\s\s+/gm,replace:" "},br:{match:/<br\s*\/?>/gim,replace:""},html:{match:/(<((?!b|\/b|!strong|\/strong)[^>]+)>)/gi,replace:""}};return class{constructor(e,t){let{onMoreLess:i=(()=>{}),regex:l={},config:s}=void 0===t?{}:t;const a=document.querySelectorAll(e);this.onMoreLess=i,this.regex=Object.assign(n,l);for(let e=0;e<a.length;e++){const{type:t,limit:n,element:i,after:l,more:r,less:c,number:o,ellipsis:d,btnClass:h,btnClassAppend:p}=JSON.parse(a[e].getAttribute("data-config"))||s;this.object={index:e,element:a[e],type:t,limit:n,classArray:a[e].classList,ellipsis:d,typeElement:i||"span",more:r||!1,less:c||!1,number:o||!1,after:l||0,btnClass:h||"show-more-btn",btnClassAppend:p||null},this.initial(this.object)}}initial(e){let{element:n,after:i,ellipsis:l,limit:s,type:a}=e;n.ariaExpanded=!1;const r=s+i,c=!1===l?"":"...";if("text"===a){let e="";const t=n.innerHTML.trim();let i=n.textContent.trim(),l=t;for(let e in this.regex){const{match:t,replace:n}=this.regex[e];e&&t&&(l=l.replace(t,n))}i.length>r&&(e=function(e,t){let n=document.createElement("div");return n.innerHTML=e,function e(t,n){let i=t.firstChild;do{3===i.nodeType?n(i):1===i.nodeType&&i.childNodes&&i.childNodes[0]&&e(i,n)}while(i=i.nextSibling)}(n,(function(e){if(t>0){let n=e.data.length;(t-=n)<=0&&(e.data=e.substringData(0,e.data.length+t))}else e.data=""})),n.innerHTML}(l,s).concat(c),n.innerHTML=e,this.addBtn(this.object),this.clickEvent(n,{...this.object,originalText:t,truncatedText:e}))}if("list"===a||"table"===a){const e="list"===a?[].slice.call(n.children):n.rows;if(e.length>r){for(let n=s;n<e.length;n++)t(e[n],!0);this.addBtn(this.object),this.clickEvent("list"===a?n:n.nextElementSibling,this.object)}}}clickEvent(e,t){e.addEventListener("click",this.handleEvent.bind(this,t))}createBtn(t){let{element:n,number:i,less:l,more:s,type:a,btnClass:r,btnClassAppend:c}=t;const o=this.checkExp?l||"":s||"",d=this.checkExp?"collapse":"expand",h=!!this.checkExp,p=document.createElement("button");return p.className=null==c?r:r+" "+c,p.ariaExpanded=h,p.ariaLabel=d,p.tabindex=0,p.innerHTML=i?o+e(n,a):o,p}handleEvent(e,n){let{currentTarget:i,target:l}=n;const{element:s,type:a,limit:r,less:c,typeElement:o,originalText:d,truncatedText:h,btnClass:p}=e,m=l.classList.contains(p);if(!m)return;const b=s.getAttribute("aria-expanded");if(this.checkExp="false"===b,"text"===a&&m&&(s.innerHTML="",s.innerHTML=this.checkExp?d:h,c)){const t=document.createElement(o);t.insertAdjacentElement("beforeend",this.createBtn(e)),s.appendChild(t)}if("list"===a||"table"===a){const e="list"===a?[].slice.call(i.children):s.rows;for(let n=0;n<e.length;n++){const i="list"===a?n>=r&&n<e.length-1:n>=r;"false"===b?t(e[n]):i&&t(e[n],!0)}}"table"!==a&&"list"!==a&&"text"!==a||this.setExpand({...e,target:l})}addBtn(e){const{type:t,element:n,more:i,typeElement:l}=e;if(i)if("table"===t)n.insertAdjacentElement("afterend",this.createBtn(e));else{const t=document.createElement(l);t.appendChild(this.createBtn(e)),n.appendChild(t)}}setExpand(t){const{element:n,type:i,less:l,more:s,number:a,target:r}=t,c=this.checkExp,o=c?l:s,d=c?"expand":"collapse",h="table"===i?i:"the "+i,p=n.lastElementChild;n.ariaExpanded=c,r.ariaExpanded=c,r.ariaLabel=d+" "+h,this.onMoreLess(d,t),o?r.innerHTML=a?o+e(n,i):o:"table"===i?r.parentNode.removeChild(r):"list"===i&&p.parentNode.removeChild(p)}}}));
