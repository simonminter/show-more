{"version":3,"file":"showMore.min.js","sources":["../sources/utils/function.js","../sources/utils/regex.js","../sources/index.js"],"sourcesContent":["/**\r\n * Get hidden element\r\n *\r\n * @param {object} object\r\n * @param {String} type - type of element table | div\r\n * @returns\r\n */\r\nfunction getNumber({ rows, children }, type) {\r\n  const elementType = type === 'table' ? rows : children;\r\n\r\n  const numbersElementHidden = [].slice\r\n    .call(elementType)\r\n    .filter((el) => el.className === 'hidden').length;\r\n  return numbersElementHidden !== 0 ? ` ${numbersElementHidden}` : '';\r\n}\r\n\r\n// https://stackoverflow.com/questions/6003271/substring-text-with-html-tags-in-javascript\r\n/**\r\n * Substring text width html tags\r\n *\r\n * @param {String} originalText - text with html tags\r\n * @param {String} count - limit of characters\r\n * @returns\r\n */\r\nfunction htmlSubstr(originalText, count) {\r\n  let div = document.createElement('div');\r\n  div.innerHTML = originalText;\r\n\r\n  walk(div, track);\r\n\r\n  function track(el) {\r\n    if (count > 0) {\r\n      let len = el.data.length;\r\n      count -= len;\r\n      if (count <= 0) {\r\n        el.data = el.substringData(0, el.data.length + count);\r\n      }\r\n    } else {\r\n      el.data = '';\r\n    }\r\n  }\r\n\r\n  function walk(el, fn) {\r\n    let node = el.firstChild;\r\n    do {\r\n      if (node.nodeType === 3) {\r\n        fn(node);\r\n      } else if (node.nodeType === 1 && node.childNodes && node.childNodes[0]) {\r\n        walk(node, fn);\r\n      }\r\n    } while ((node = node.nextSibling));\r\n  }\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Add/remove class 'hidden' to element\r\n *\r\n * @param {HTMLElement} element\r\n * @param {String} type - type of element add or remove\r\n */\r\nfunction addRemoveClass(element, type = false) {\r\n  element.classList[type ? 'add' : 'remove']('hidden');\r\n}\r\n\r\nexport { addRemoveClass, getNumber, htmlSubstr };\r\n","/**\r\n * Default regexes for validation\r\n */\r\nconst defaultRegex = {\r\n  newLine: {\r\n    match: /(\\r\\n|\\n|\\r)/gm,\r\n    replace: '',\r\n  },\r\n  space: {\r\n    match: /\\s\\s+/gm,\r\n    replace: ' ',\r\n  },\r\n  br: {\r\n    match: /<br\\s*\\/?>/gim,\r\n    replace: '',\r\n  },\r\n  html: {\r\n    match: /(<((?!b|\\/b|!strong|\\/strong)[^>]+)>)/gi,\r\n    replace: '',\r\n  },\r\n};\r\n\r\nexport default defaultRegex;\r\n","import { addRemoveClass, getNumber, htmlSubstr } from './utils/function';\r\nimport defaultRegex from './utils/regex';\r\n\r\n/**\r\n * @class ShowMore\r\n */\r\nexport default class ShowMore {\r\n  /**\r\n   * Constructor\r\n   *\r\n   * @param {HTMLElement} className\r\n   * @param {Object} object\r\n   */\r\n  constructor(className, { onMoreLess = () => {}, regex = {}, config } = {}) {\r\n    // all html elements\r\n    const elements = document.querySelectorAll(className);\r\n\r\n    // colback function\r\n    this.onMoreLess = onMoreLess;\r\n\r\n    // global regex\r\n    this.regex = Object.assign(defaultRegex, regex);\r\n\r\n    for (let i = 0; i < elements.length; i++) {\r\n      const {\r\n        type,\r\n        limit,\r\n        element,\r\n        after,\r\n        more,\r\n        less,\r\n        number,\r\n        ellipsis,\r\n        btnClass,\r\n        btnClassAppend,\r\n      } = JSON.parse(elements[i].getAttribute('data-config')) || config;\r\n\r\n      // create global object\r\n      this.object = {\r\n        index: i,\r\n        element: elements[i],\r\n        type,\r\n        limit,\r\n        classArray: elements[i].classList,\r\n        ellipsis,\r\n        typeElement: element || 'span',\r\n        more: more || false,\r\n        less: less || false,\r\n        number: number || false,\r\n        after: after || 0,\r\n        btnClass: btnClass || 'show-more-btn',\r\n        btnClassAppend: btnClassAppend || null,\r\n      };\r\n\r\n      this.initial(this.object);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initail function\r\n   *\r\n   * @param {Object} object\r\n   */\r\n  initial({ element, after, ellipsis, limit, type }) {\r\n    // set default aria-expande to false\r\n    element.setAttribute('aria-expanded', 'false');\r\n\r\n    const limitCounts = limit + after;\r\n    const ellips = ellipsis === false ? '' : '...';\r\n\r\n    // text\r\n    if (type === 'text') {\r\n      let truncatedText = '';\r\n      const originalText = element.innerHTML.trim();\r\n      let elementText = element.textContent.trim();\r\n\r\n      let orgTexReg = originalText;\r\n      for (let key in this.regex) {\r\n        const { match, replace } = this.regex[key];\r\n        if (key && match) orgTexReg = orgTexReg.replace(match, replace);\r\n      }\r\n\r\n      if (elementText.length > limitCounts) {\r\n        truncatedText = htmlSubstr(orgTexReg, limit).concat(ellips);\r\n\r\n        element.innerHTML = truncatedText;\r\n\r\n        this.addBtn(this.object);\r\n\r\n        this.clickEvent(element, {\r\n          ...this.object,\r\n          originalText,\r\n          truncatedText,\r\n        });\r\n      }\r\n    }\r\n\r\n    // list and table\r\n    if (type === 'list' || type === 'table') {\r\n      const items =\r\n        type === 'list' ? [].slice.call(element.children) : element.rows;\r\n\r\n      if (items.length > limitCounts) {\r\n        for (let i = limit; i < items.length; i++) {\r\n          addRemoveClass(items[i], true);\r\n        }\r\n\r\n        // add button to the list and table\r\n        this.addBtn(this.object);\r\n\r\n        // add event click\r\n        this.clickEvent(\r\n          type === 'list' ? element : element.nextElementSibling,\r\n          this.object\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Event click\r\n   *\r\n   * @param {HTMLElement} element\r\n   * @param {Object} object\r\n   */\r\n  clickEvent(element, object) {\r\n    element.addEventListener('click', this.handleEvent.bind(this, object));\r\n  }\r\n\r\n  /**\r\n   * Create button\r\n   *\r\n   * @param {Object} object\r\n   * @returns HTMLElement\r\n   */\r\n  createBtn({ element, number, less, more, type, btnClass, btnClassAppend }) {\r\n    const typeAria = this.checkExp ? less || '' : more || '';\r\n    const label = this.checkExp ? 'collapse' : 'expand';\r\n    const expanded = this.checkExp ? true : false;\r\n\r\n    const btn = document.createElement('button');\r\n    btn.className =\r\n      btnClassAppend == null ? btnClass : btnClass + ' ' + btnClassAppend;\r\n    btn.setAttribute('aria-expanded', expanded);\r\n    btn.setAttribute('aria-label', label);\r\n    btn.setAttribute('tabindex', 0);\r\n    btn.innerHTML = number ? typeAria + getNumber(element, type) : typeAria;\r\n    return btn;\r\n  }\r\n\r\n  /**\r\n   * Event handler\r\n   *\r\n   * @param {Object} object\r\n   * @param {Event} event\r\n   */\r\n  handleEvent(object, { currentTarget, target }) {\r\n    const {\r\n      element,\r\n      type,\r\n      limit,\r\n      less,\r\n      typeElement,\r\n      originalText,\r\n      truncatedText,\r\n      btnClass,\r\n    } = object;\r\n\r\n    // check if the button is clicked\r\n    const checkContainsClass = target.classList.contains(btnClass);\r\n\r\n    if (!checkContainsClass) return;\r\n\r\n    const ariaExpanded = element.getAttribute('aria-expanded');\r\n    this.checkExp = ariaExpanded === 'false';\r\n\r\n    // --------------------------------------------------\r\n    // text\r\n    if (type === 'text' && checkContainsClass) {\r\n      element.innerHTML = '';\r\n      element.innerHTML = this.checkExp ? originalText : truncatedText;\r\n\r\n      if (less) {\r\n        const el = document.createElement(typeElement);\r\n        el.insertAdjacentElement('beforeend', this.createBtn(object));\r\n        element.appendChild(el);\r\n      }\r\n    }\r\n\r\n    // --------------------------------------------------\r\n    // list and table\r\n    if (type === 'list' || type === 'table') {\r\n      const items =\r\n        type === 'list' ? [].slice.call(currentTarget.children) : element.rows;\r\n\r\n      for (let i = 0; i < items.length; i++) {\r\n        const typeRemove =\r\n          type === 'list' ? i >= limit && i < items.length - 1 : i >= limit;\r\n\r\n        if (ariaExpanded === 'false') {\r\n          addRemoveClass(items[i]);\r\n        } else if (typeRemove) {\r\n          addRemoveClass(items[i], true);\r\n        }\r\n      }\r\n    }\r\n\r\n    // set aria-expanded\r\n    if (type === 'table' || type === 'list' || type === 'text') {\r\n      this.setExpand({ ...object, target });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add button\r\n   *\r\n   * @param {Object} object\r\n   */\r\n  addBtn(object) {\r\n    const { type, element, more, typeElement } = object;\r\n\r\n    if (!more) return;\r\n\r\n    if (type === 'table') {\r\n      element.insertAdjacentElement('afterend', this.createBtn(object));\r\n    } else {\r\n      const el = document.createElement(typeElement);\r\n      el.appendChild(this.createBtn(object));\r\n      element.appendChild(el);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set aria-expanded\r\n   *\r\n   * @param {Object} object\r\n   */\r\n  setExpand(object) {\r\n    const { element, type, less, more, number, target } = object;\r\n\r\n    const check = this.checkExp;\r\n\r\n    const typeAria = check ? less : more;\r\n    const aria = check ? 'expand' : 'collapse';\r\n    const ariaText = type === 'table' ? type : `the ${type}`;\r\n    const lastChild = element.lastElementChild;\r\n\r\n    element.setAttribute('aria-expanded', check);\r\n    target.setAttribute('aria-expanded', check);\r\n    target.setAttribute('aria-label', `${aria} ${ariaText}`);\r\n\r\n    // callback function on more/less\r\n    this.onMoreLess(aria, object);\r\n\r\n    if (typeAria) {\r\n      target.innerHTML = number\r\n        ? typeAria + getNumber(element, type)\r\n        : typeAria;\r\n    } else if (type === 'table') {\r\n      target.parentNode.removeChild(target);\r\n    } else if (type === 'list') {\r\n      lastChild.parentNode.removeChild(lastChild);\r\n    }\r\n  }\r\n}\r\n"],"names":["getNumber","type","rows","children","elementType","numbersElementHidden","slice","call","filter","el","className","length","addRemoveClass","element","classList","defaultRegex","newLine","match","replace","space","br","html","constructor","onMoreLess","regex","config","elements","document","querySelectorAll","Object","assign","i","limit","after","more","less","number","ellipsis","btnClass","btnClassAppend","JSON","parse","getAttribute","object","index","classArray","typeElement","initial","this","setAttribute","limitCounts","ellips","truncatedText","originalText","innerHTML","trim","elementText","textContent","orgTexReg","key","count","div","createElement","walk","fn","node","firstChild","nodeType","childNodes","nextSibling","len","data","substringData","htmlSubstr","concat","addBtn","clickEvent","items","nextElementSibling","addEventListener","handleEvent","bind","createBtn","typeAria","checkExp","label","expanded","btn","currentTarget","target","checkContainsClass","contains","ariaExpanded","insertAdjacentElement","appendChild","typeRemove","setExpand","check","aria","ariaText","lastChild","lastElementChild","parentNode","removeChild"],"mappings":"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"}